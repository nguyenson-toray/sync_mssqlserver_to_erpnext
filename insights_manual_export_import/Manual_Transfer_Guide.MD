# HÆ°á»›ng Dáº«n Export/Import Thá»§ CÃ´ng Insights Data

## ğŸ“‹ Tá»•ng Quan

Script `insights_manual_export_import.py` Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ export Insights data thÃ nh cÃ¡c file cÃ³ thá»ƒ transfer thá»§ cÃ´ng giá»¯a cÃ¡c servers khÃ¡c nhau. Script Ä‘Æ°á»£c xÃ¢y dá»±ng dá»±a trÃªn class `InsightsManualTransfer` vá»›i kháº£ nÄƒng tá»± Ä‘á»™ng nháº­n diá»‡n DocType vÃ  há»— trá»£ multiple format export.

### âœ¨ TÃ­nh NÄƒng ChÃ­nh:
- ğŸ—ƒï¸ **Export Ä‘a Ä‘á»‹nh dáº¡ng**: JSON, SQL, CSV vá»›i kháº£ nÄƒng tá»± chá»n format
- ğŸ“¦ **Táº¡o ZIP package** tá»± Ä‘á»™ng chá»©a táº¥t cáº£ cÃ¡c format Ä‘Ã£ export
- ğŸ”„ **Import tá»± Ä‘á»™ng** tá»« JSON files hoáº·c ZIP package
- ğŸ›¡ï¸ **Backup tá»± Ä‘á»™ng** trÆ°á»›c khi import Ä‘á»ƒ Ä‘áº£m báº£o an toÃ n
- ğŸ“Š **Export summary** chi tiáº¿t vá»›i thá»‘ng kÃª sá»‘ lÆ°á»£ng records
- ğŸ” **DocType auto-detection** tá»± Ä‘á»™ng phÃ¡t hiá»‡n cÃ¡c báº£ng Insights cÃ³ sáºµn
- ğŸ“‹ **Table mapping** tá»« file `insights_table_transfer.txt`

### ğŸ“ CÃ¡c DocType ÄÆ°á»£c Transfer:
Script tá»± Ä‘á»™ng load cÃ¡c DocType tá»« file `insights_table_transfer.txt` vÃ  há»— trá»£ cÃ¡c alternative names:
- âœ… **Insights Chart v3** (hoáº·c "Chart v3")
- âœ… **Insights Dashboard v3** (hoáº·c "Dashboard v3") 
- âœ… **Insights Dashboard Chart v3** (hoáº·c "Dashboard Chart v3")
- âœ… **Insights Query v3** (hoáº·c "Query v3")
- âœ… **Insights Workbook** (hoáº·c "Workbook")
- âœ… CÃ¡c DocType khÃ¡c Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong `insights_table_transfer.txt`

## ğŸ› ï¸ YÃªu Cáº§u Há»‡ Thá»‘ng

### TrÃªn Cáº£ 2 Servers:
- **ERPNext/Frappe Framework** Ä‘Ã£ cÃ i Ä‘áº·t
- **Insights App** Ä‘Ã£ cÃ i Ä‘áº·t
- **Python 3.x**
- **Quyá»n truy cáº­p** bench commands

### Kiá»ƒm Tra Insights App:
```bash
# Kiá»ƒm tra app
bench --site your-site list-apps | grep insights

# CÃ i Ä‘áº·t náº¿u chÆ°a cÃ³
bench get-app insights
bench --site your-site install-app insights
```

## ğŸ“¥ Sá»­ Dá»¥ng Script

### 1. Script Location
Script Ä‘Æ°á»£c Ä‘áº·t trong thÆ° má»¥c:
```bash
/home/sonnt/frappe-bench/sync_mssqlserver_to_erpnext/sync_mssqlserver_to_erpnext/insights_manual_export_import/insights_manual_export_import.py
```

### 2. Command Line Usage
```bash
# Export (táº¥t cáº£ format)
python3 insights_manual_export_import.py export <site_name>

# Export format cá»¥ thá»ƒ
python3 insights_manual_export_import.py export <site_name> [json|sql|csv|all]

# Import
python3 insights_manual_export_import.py import <site_name> <file_or_dir_path>
```

### 3. Examples
```bash
# Export táº¥t cáº£ format tá»« site source
python3 insights_manual_export_import.py export erp-sonnt.tiqn.local

# Export chá»‰ JSON
python3 insights_manual_export_import.py export erp-sonnt.tiqn.local json

# Import tá»« ZIP package
python3 insights_manual_export_import.py import erp.tiqn.local insights_export_20250724_103015.zip

# Import tá»« JSON directory
python3 insights_manual_export_import.py import erp.tiqn.local insights_export_20250724_103015/
```

## ğŸš€ CÃ¡ch Sá»­ Dá»¥ng

### ğŸ“¤ EXPORT DATA (TrÃªn Server Nguá»“n)

#### PhÆ°Æ¡ng PhÃ¡p 1: Sá»­ Dá»¥ng Script (Khuyáº¿n nghá»‹)
```bash
cd /home/sonnt/frappe-bench/sync_mssqlserver_to_erpnext/sync_mssqlserver_to_erpnext/insights_manual_export_import

# Export táº¥t cáº£ format (táº¡o ZIP package)
python3 insights_manual_export_import.py export erp-sonnt.tiqn.local

# Hoáº·c export chá»‰ JSON
python3 insights_manual_export_import.py export erp-sonnt.tiqn.local json
```

**Output máº«u:**
```
ğŸš€ Starting export from erp-sonnt.tiqn.local
ğŸ“‹ Format: all
[14:30:15] INFO: Starting JSON export from erp-sonnt.tiqn.local
[14:30:15] INFO: Current directory: /home/sonnt/frappe-bench
[14:30:15] INFO: Sites directory exists: True
[14:30:15] INFO: Target site exists: True
[14:30:16] INFO: Exporting 2 records from Insights Data Source
[14:30:16] INFO: âœ… Exported 2 records to insights_data_source.json  
[14:30:16] INFO: Exporting 1 records from Insights Workbook
[14:30:16] INFO: âœ… Exported 1 records to insights_workbook.json
[14:30:16] INFO: âœ… JSON export completed: insights_export_20250724_143016
âœ… Export completed successfully!
ğŸ“ Export location: insights_export_20250724_143016.zip
```

#### PhÆ°Æ¡ng PhÃ¡p 2: Sá»­ Dá»¥ng Bench Console (Thay tháº¿)
```bash
cd ~/frappe-bench
bench --site erp-sonnt.tiqn.local console
```

Sau Ä‘Ã³ paste Ä‘oáº¡n code sau vÃ o console:
```python
import json
import os
from datetime import datetime

# Simple export function
timestamp = datetime.now().strftime('%Y%m%d_%H%M%S')
export_dir = f'/home/sonnt/frappe-bench/sync_mssqlserver_to_erpnext/sync_mssqlserver_to_erpnext/insights_manual_export_import/insights_export_{timestamp}'
os.makedirs(export_dir, exist_ok=True)

doctypes = ['Insights Settings', 'Insights Data Source', 'Insights Query', 'Insights Chart', 'Insights Workbook', 'Insights Dashboard']

print(f'Starting export from {frappe.local.site}')
total_records = 0

for doctype in doctypes:
    try:
        if not frappe.db.exists('DocType', doctype):
            print(f'DocType {doctype} not found, skipping')
            continue
        
        records = frappe.get_all(doctype, fields=['name'])
        print(f'Found {len(records)} {doctype} records')
        
        if not records:
            continue
        
        full_records = []
        for record in records:
            try:
                doc = frappe.get_doc(doctype, record.name)
                doc_dict = doc.as_dict()
                
                system_fields = ['creation', 'modified', 'modified_by', 'owner', 'idx']
                for field in system_fields:
                    if field in doc_dict:
                        del doc_dict[field]
                
                full_records.append(doc_dict)
            except Exception as e:
                print(f'Error exporting {record.name}: {str(e)}')
        
        filename = f'{doctype.replace(" ", "_").lower()}.json'
        filepath = os.path.join(export_dir, filename)
        
        with open(filepath, 'w', encoding='utf-8') as f:
            json.dump(full_records, f, indent=2, default=str, ensure_ascii=False)
        
        total_records += len(full_records)
        print(f'Exported {len(full_records)} {doctype} records to {filename}')
        
    except Exception as e:
        print(f'Error processing {doctype}: {str(e)}')

print(f'Export completed! Files saved to: {export_dir}')
print(f'Total records exported: {total_records}')
```

**Output máº«u:**
```
Starting export from erp-sonnt.tiqn.local
Found 2 Insights Data Source records
Exported 2 Insights Data Source records to insights_data_source.json
Found 1 Insights Workbook records  
Exported 1 Insights Workbook records to insights_workbook.json
Export completed! Files saved to: insights_export_20250724_203809
Total records exported: 3
```

#### 3. Script tÆ°Æ¡ng thÃ­ch vá»›i Bench Environment
**âš ï¸ LÆ°u Ã½: Khi cháº¡y script tá»« bench environment**

```bash
cd ~/frappe-bench

# Sá»­ dá»¥ng Frappe's Python environment
./env/bin/python sync_mssqlserver_to_erpnext/sync_mssqlserver_to_erpnext/insights_manual_export_import/insights_manual_export_import.py export erp-sonnt.tiqn.local

# Hoáº·c tá»« thÆ° má»¥c script
cd sync_mssqlserver_to_erpnext/sync_mssqlserver_to_erpnext/insights_manual_export_import
../../../env/bin/python insights_manual_export_import.py export erp-sonnt.tiqn.local
```

### ğŸ“‚ Cáº¥u TrÃºc File Export

**Script Export - ThÆ° má»¥c táº¡m (ná»™i bá»™):**
```
insights_export_20250724_143016/
â”œâ”€â”€ export_summary.json              # TÃ³m táº¯t export vá»›i metadata
â”œâ”€â”€ insights_chart_v3.json           # Chart data (náº¿u cÃ³)
â”œâ”€â”€ insights_dashboard_v3.json       # Dashboard data (náº¿u cÃ³)
â”œâ”€â”€ insights_dashboard_chart_v3.json # Dashboard Chart relationships
â”œâ”€â”€ insights_query_v3.json           # Query data (náº¿u cÃ³)
â”œâ”€â”€ insights_workbook.json           # Workbook data
â”œâ”€â”€ insights_data.sql                # SQL dump (náº¿u chá»n SQL format)
â””â”€â”€ csv/                             # CSV files (náº¿u chá»n CSV format)
    â”œâ”€â”€ insights_chart_v3.csv
    â”œâ”€â”€ insights_dashboard_v3.csv
    â””â”€â”€ ...
```

**Script Export - Final Output:**
```
insights_export_20250724_143016.zip  # ZIP package chá»©a táº¥t cáº£
â”œâ”€â”€ All JSON files
â”œâ”€â”€ SQL dump (if requested)
â”œâ”€â”€ CSV directory (if requested)  
â””â”€â”€ export_summary.json
```

**Console Export (ThÆ° má»¥c JSON tá»« console):**
```
~/frappe-bench/sites/insights_export_20250724_203809/
â”œâ”€â”€ insights_data_source.json        # Data source data (2 records)
â”œâ”€â”€ insights_workbook.json           # Workbook data (1 record)
â””â”€â”€ (cÃ¡c file khÃ¡c tÃ¹y theo data cÃ³ sáºµn)
```

**VÃ­ dá»¥ thá»±c táº¿ tá»« export gáº§n Ä‘Ã¢y:**
```
sites/insights_export_20250724_203809/
â”œâ”€â”€ insights_data_source.json        # 2 data sources: Site DB, Query Store
â””â”€â”€ insights_workbook.json           # 1 workbook: "Inline" vá»›i 2 queries vÃ  2 charts
```

## ğŸ“‹ Transfer Files Giá»¯a Servers

### PhÆ°Æ¡ng PhÃ¡p 1: SCP (Khuyáº¿n nghá»‹)
```bash
# Script export location (trong thÆ° má»¥c script)
SCRIPT_DIR="/home/sonnt/frappe-bench/sync_mssqlserver_to_erpnext/sync_mssqlserver_to_erpnext/insights_manual_export_import"

# Copy ZIP file tá»« script export
scp $SCRIPT_DIR/insights_export_20250724_143016.zip user@target-server:~/insights-transfer/

# Copy thÆ° má»¥c export tá»« console (náº¿u dÃ¹ng console method)
scp -r ~/frappe-bench/sites/insights_export_20250724_203809/ user@target-server:~/insights-transfer/
```

### PhÆ°Æ¡ng PhÃ¡p 2: SFTP
```bash
sftp user@target-server
# Upload thÆ° má»¥c export
put -r ~/frappe-bench/sites/insights_export_20250724_203809/ ~/insights-transfer/
quit
```

### PhÆ°Æ¡ng PhÃ¡p 3: ZIP vÃ  Transfer
```bash
# Táº¡o ZIP tá»« export directory
cd ~/frappe-bench/sites/
zip -r insights_export_20250724_203809.zip insights_export_20250724_203809/

# Transfer ZIP
scp insights_export_20250724_203809.zip user@target-server:~/insights-transfer/

# TrÃªn server Ä‘Ã­ch: extract
cd ~/insights-transfer/
unzip insights_export_20250724_203809.zip
```

### PhÆ°Æ¡ng PhÃ¡p 4: Cloud Storage
```bash
# Upload lÃªn Google Drive/Dropbox/AWS S3
zip -r insights_export.zip ~/frappe-bench/sites/insights_export_*/
# Upload báº±ng web interface hoáº·c CLI tools
# Download trÃªn server Ä‘Ã­ch vÃ o ~/insights-transfer/
```

## ğŸ“¥ IMPORT DATA (TrÃªn Server ÄÃ­ch)

### PhÆ°Æ¡ng PhÃ¡p 1: Sá»­ Dá»¥ng Script (Khuyáº¿n nghá»‹)
```bash
cd /path/to/script/directory

# Import tá»« ZIP package
python3 insights_manual_export_import.py import erp.tiqn.local ~/insights-transfer/insights_export_20250724_143016.zip

# Import tá»« JSON directory
python3 insights_manual_export_import.py import erp.tiqn.local ~/insights-transfer/insights_export_20250724_203809/
```

**Output Import máº«u:**
```
ğŸš€ Starting import to erp.tiqn.local
ğŸ“ Import from: ~/insights-transfer/insights_export_20250724_143016.zip
[15:30:10] INFO: Importing from ZIP: insights_export_20250724_143016.zip
[15:30:10] INFO: Starting JSON import to erp.tiqn.local  
[15:30:10] INFO: Creating backup before import...
[15:30:12] INFO: Importing 2 records to Insights Data Source
[15:30:12] INFO: Created: Query Store
[15:30:12] INFO: Updated: Site DB
[15:30:12] INFO: âœ… Imported 2/2 records from insights_data_source.json
[15:30:13] INFO: Importing 1 records to Insights Workbook
[15:30:13] INFO: Created: Inline
[15:30:13] INFO: âœ… Imported 1/1 records from insights_workbook.json
[15:30:13] INFO: âœ… Import completed. Total records imported: 3
âœ… Import completed successfully!
ğŸ”” Please verify your data in Insights app
```

### PhÆ°Æ¡ng PhÃ¡p 2: Sá»­ Dá»¥ng Bench Console (Thay tháº¿)
```bash
cd ~/frappe-bench
bench --site erp.tiqn.local console
```

Sau Ä‘Ã³ paste Ä‘oáº¡n code sau vÃ o console:
```python
import json
import os
from datetime import datetime

def import_insights_data(import_dir):
    """Import insights data from exported JSON files"""
    
    print(f'ğŸš€ Starting import to {frappe.local.site}')
    print(f'ğŸ“ Import from: {import_dir}')
    
    # Táº¡o backup trÆ°á»›c khi import
    print('[INFO] Creating backup before import...')
    frappe.utils.backup.new_backup(ignore_files=True, backup_path_db='/tmp/')
    
    # Thá»© tá»± import theo dependency
    import_order = [
        "insights_settings.json",
        "insights_data_source.json", 
        "insights_query.json",
        "insights_chart.json",
        "insights_workbook.json",
        "insights_dashboard.json"
    ]
    
    total_imported = 0
    
    for filename in import_order:
        filepath = os.path.join(import_dir, filename)
        
        if not os.path.exists(filepath):
            print(f'File {filename} not found, skipping')
            continue
            
        try:
            with open(filepath, 'r', encoding='utf-8') as f:
                records = json.load(f)
                
            if not records:
                print(f'No records in {filename}')
                continue
                
            doctype = records[0].get('doctype')
            print(f'[INFO] Importing {len(records)} records to {doctype}')
            
            imported_count = 0
            for record in records:
                try:
                    # XÃ³a cÃ¡c field khÃ´ng cáº§n thiáº¿t
                    if 'doctype' in record:
                        del record['doctype']
                    
                    # Kiá»ƒm tra record Ä‘Ã£ tá»“n táº¡i chÆ°a
                    existing = None
                    try:
                        existing = frappe.get_doc(doctype, record['name'])
                        print(f'[INFO] Updated: {record.get("title", record["name"])}')
                        # Update existing record
                        for key, value in record.items():
                            setattr(existing, key, value)
                        existing.save()
                    except frappe.DoesNotExistError:
                        # Táº¡o record má»›i
                        new_doc = frappe.get_doc(record)
                        new_doc.doctype = doctype
                        new_doc.insert()
                        print(f'[INFO] Created: {record.get("title", record["name"])}')
                    
                    imported_count += 1
                    
                except Exception as e:
                    print(f'[ERROR] Failed to import {record.get("name", "unknown")}: {str(e)}')
            
            total_imported += imported_count
            print(f'âœ… Imported {imported_count}/{len(records)} records from {filename}')
            
        except Exception as e:
            print(f'[ERROR] Failed to process {filename}: {str(e)}')
    
    print(f'âœ… Import completed! Total records: {total_imported}')
    print('ğŸ”” Please verify your data in Insights app')
    
    return total_imported

# Sá»­ dá»¥ng function vá»›i Ä‘Æ°á»ng dáº«n export directory
import_dir = '/home/frappe/frappe-bench/insights-transfer/insights_export_20250724_203809'  # Sá»­a Ä‘Æ°á»ng dáº«n theo thá»±c táº¿
import_insights_data(import_dir)
```

### 3. Import vá»›i Bench Environment
```bash
cd ~/frappe-bench

# Sá»­ dá»¥ng Frappe's Python environment
./env/bin/python sync_mssqlserver_to_erpnext/sync_mssqlserver_to_erpnext/insights_manual_export_import/insights_manual_export_import.py import erp.tiqn.local ~/insights-transfer/insights_export_20250724_143016.zip

# Hoáº·c tá»« JSON directory
./env/bin/python sync_mssqlserver_to_erpnext/sync_mssqlserver_to_erpnext/insights_manual_export_import/insights_manual_export_import.py import erp.tiqn.local ~/insights-transfer/insights_export_20250724_203809/
```

**Output Import máº«u:**
```
ğŸš€ Starting import to erp.tiqn.local
ğŸ“ Import from: /home/frappe/frappe-bench/insights-transfer/insights_export_20250724_203809
[INFO] Creating backup before import...
[INFO] Importing 2 records to Insights Data Source
[INFO] Created: Site DB
[INFO] Created: Query Store  
âœ… Imported 2/2 records from insights_data_source.json
[INFO] Importing 1 records to Insights Workbook
[INFO] Created: Inline
âœ… Imported 1/1 records from insights_workbook.json
âœ… Import completed! Total records: 3
ğŸ”” Please verify your data in Insights app
```

## ğŸ”§ Scripts Tá»± Äá»™ng HÃ³a

### Export Script (`export_insights.sh`)
```bash
#!/bin/bash

SITE="erp-sonnt.tiqn.local"
SCRIPT_DIR="/home/sonnt/frappe-bench/sync_mssqlserver_to_erpnext/sync_mssqlserver_to_erpnext/insights_manual_export_import"
SCRIPT_PATH="$SCRIPT_DIR/insights_manual_export_import.py"

echo "ğŸš€ Starting Insights export from $SITE..."

# Chuyá»ƒn Ä‘áº¿n thÆ° má»¥c script
cd $SCRIPT_DIR

# Export vá»›i script
python3 $SCRIPT_PATH export $SITE

# TÃ¬m file export má»›i nháº¥t trong script directory  
EXPORT_FILE=$(ls -t $SCRIPT_DIR/insights_export_*.zip 2>/dev/null | head -1)

if [ -f "$EXPORT_FILE" ]; then
    echo "âœ… Export completed: $EXPORT_FILE"
    echo "ğŸ“‹ File size: $(du -h $EXPORT_FILE | cut -f1)"
    echo "ğŸ“ Location: $EXPORT_FILE"
    echo ""
    echo "ğŸ“¤ Next steps:"
    echo "   1. Transfer: scp $EXPORT_FILE user@target-server:~/insights-transfer/"
    echo "   2. Import: python3 insights_manual_export_import.py import target-site $EXPORT_FILE"
else
    echo "âŒ No export file found!"
    echo "ğŸ“‹ Available files in $SCRIPT_DIR:"
    ls -la $SCRIPT_DIR/insights_export_* 2>/dev/null || echo "   (none)"
fi
```

### Import Script (`import_insights.sh`)
```bash
#!/bin/bash

SITE="erp.tiqn.local"
SCRIPT_DIR="/path/to/insights_manual_export_import"  # Adjust this path
SCRIPT_PATH="$SCRIPT_DIR/insights_manual_export_import.py"
TRANSFER_DIR="~/insights-transfer"

echo "ğŸš€ Starting Insights import to $SITE..."

# Kiá»ƒm tra arguments
if [ $# -eq 1 ]; then
    IMPORT_FILE="$1"
    echo "ğŸ“¦ Using provided file: $IMPORT_FILE"
else
    # TÃ¬m file import má»›i nháº¥t trong transfer directory
    IMPORT_FILE=$(ls -t $TRANSFER_DIR/insights_export_*.zip 2>/dev/null | head -1)
fi

if [ -f "$IMPORT_FILE" ]; then
    echo "ğŸ“¦ Import file: $IMPORT_FILE"
    echo "ğŸ“‹ File size: $(du -h $IMPORT_FILE | cut -f1)"
    echo ""
    
    # Chuyá»ƒn Ä‘áº¿n thÆ° má»¥c script
    cd $SCRIPT_DIR
    
    # Import
    python3 $SCRIPT_PATH import $SITE "$IMPORT_FILE"
    
    if [ $? -eq 0 ]; then
        echo ""
        echo "âœ… Import completed successfully!"
        echo "ğŸ”” Please check Insights app to verify data"
        echo "ğŸ“‹ Next steps:"
        echo "   1. Login to ERPNext: http://your-site"
        echo "   2. Open Insights app"
        echo "   3. Verify Dashboards, Charts, Queries"
    else
        echo "âŒ Import failed! Check logs above for details."
    fi
else
    echo "âŒ No import file found!"
    echo "ğŸ“‹ Usage: ./import_insights.sh [path/to/export.zip]"
    echo "ğŸ“ Or place file in: $TRANSFER_DIR"
    echo "ğŸ“‹ Available files:"
    ls -la $TRANSFER_DIR/insights_export_* 2>/dev/null || echo "   (none)"
fi
```

### Cháº¡y Scripts:
```bash
# TrÃªn server nguá»“n
chmod +x export_insights.sh
./export_insights.sh

# TrÃªn server Ä‘Ã­ch
chmod +x import_insights.sh  
./import_insights.sh
```

## ğŸ” Troubleshooting

### Lá»—i Export

#### 1. "Site not found"
```bash
# Kiá»ƒm tra sites
bench --site all list-sites

# Hoáº·c
ls sites/
```

#### 2. "DocType not found"
```bash
# Kiá»ƒm tra Insights app
bench --site erp-sonnt.tiqn.local list-apps | grep insights

# CÃ i Ä‘áº·t náº¿u thiáº¿u
bench --site erp-sonnt.tiqn.local install-app insights
```

#### 3. "Permission denied"
```bash
# Kiá»ƒm tra quyá»n trong script directory
ls -la ~/insights-transfer/

# Táº¡o thÆ° má»¥c náº¿u cáº§n
mkdir -p ~/insights-transfer
chmod 755 ~/insights-transfer
```

### Lá»—i Transfer

#### 1. "No space left on device"
```bash
# Kiá»ƒm tra dung lÆ°á»£ng
df -h

# Dá»n dáº¹p files cÅ© trong script directory
rm -f ~/insights-transfer/insights_export_*.zip
rm -rf ~/insights-transfer/insights_export_*/
```

#### 2. "Connection refused" (SCP)
```bash
# Kiá»ƒm tra SSH service trÃªn target
ssh user@target-server "sudo systemctl status ssh"

# Test connection
telnet target-server 22
```

#### 3. "File too large"
```bash
# NÃ©n file tá»‘t hÆ¡n
cd /tmp
zip -9 insights_export_compressed.zip insights_export_*.zip

# Hoáº·c chia nhá» file
split -b 100M insights_export_large.zip insights_part_
```

### Lá»—i Import

#### 1. "Import file not found"
```bash
# Kiá»ƒm tra file trong script directory
ls -la ~/insights-transfer/insights_export_*

# Kiá»ƒm tra ná»™i dung ZIP
unzip -l ~/insights-transfer/insights_export_*.zip
```

#### 2. "Backup failed"
```bash
# Táº¡o backup manual
bench --site erp.tiqn.local backup

# Hoáº·c skip backup (khÃ´ng khuyáº¿n nghá»‹)
# Sá»­a trong script: comment dÃ²ng backup
```

#### 3. "DocType not found in system"
```bash
# CÃ i Ä‘áº·t Insights app
bench --site erp.tiqn.local install-app insights

# Migrate
bench --site erp.tiqn.local migrate

# Restart
bench restart
```

## ğŸ“Š Kiá»ƒm Tra Káº¿t Quáº£

### 1. Xem Export Summary
```bash
# Giáº£i nÃ©n vÃ  xem summary
unzip -p ~/insights-transfer/insights_export_*.zip export_summary.json | python3 -m json.tool
```

### 2. Verify Import Data
```bash
# VÃ o Frappe console
bench --site erp.tiqn.local console
```

```python
# Kiá»ƒm tra sá»‘ lÆ°á»£ng records
doctypes = [
    "Insights Dashboard",
    "Insights Chart", 
    "Insights Query",
    "Insights Data Source",
    "Insights Workbook"
]

for dt in doctypes:
    try:
        count = frappe.db.count(dt)
        print(f"{dt}: {count} records")
    except:
        print(f"{dt}: DocType not found")

# Kiá»ƒm tra dashboard cá»¥ thá»ƒ
dashboards = frappe.get_all("Insights Dashboard", fields=["name", "title"])
for d in dashboards:
    print(f"Dashboard: {d.name} - {d.title}")
```

### 3. Test Trong Insights App
1. **Login** vÃ o ERPNext site Ä‘Ã­ch
2. **Má»Ÿ Insights app**
3. **Kiá»ƒm tra Dashboards** hiá»ƒn thá»‹
4. **Test Charts** render Ä‘Ãºng
5. **Verify Data Sources** connect Ä‘Æ°á»£c

## âš ï¸ LÆ°u Ã Quan Trá»ng

### TrÆ°á»›c Khi Export:
- âœ… **Backup site nguá»“n** Ä‘á»ƒ Ä‘áº£m báº£o an toÃ n
- âœ… **Kiá»ƒm tra dung lÆ°á»£ng disk** trÃªn cáº£ 2 servers
- âœ… **Note láº¡i cÃ¡c custom settings** cÃ³ thá»ƒ bá»‹ máº¥t
- âœ… **Cháº¡y tá»« thÆ° má»¥c bench** (`~/frappe-bench`)

### TrÆ°á»›c Khi Import:
- âœ… **Backup site Ä‘Ã­ch** (import script tá»± Ä‘á»™ng lÃ m)
- âœ… **Äáº£m báº£o Insights app** Ä‘Ã£ cÃ i Ä‘áº·t vÃ  active
- âœ… **Kiá»ƒm tra version compatibility** giá»¯a 2 sites  
- âœ… **Sá»­a Ä‘Æ°á»ng dáº«n** trong import script cho Ä‘Ãºng

### Sau Khi Import: 
- âœ… **Test toÃ n bá»™ dashboards** hoáº¡t Ä‘á»™ng
- âœ… **Kiá»ƒm tra data sources** cÃ²n valid
- âœ… **Verify user permissions** trÃªn items má»›i
- âœ… **Update queries** náº¿u cáº§n thiáº¿t
- âœ… **Test charts render** Ä‘Ãºng dá»¯ liá»‡u

### Káº¿t Quáº£ Thá»±c Táº¿ (24/07/2025):
- âœ… **Export thÃ nh cÃ´ng**: 3 records (2 Data Sources + 1 Workbook)
- âœ… **Data Sources**: Site DB (MariaDB), Query Store (SQLite)  
- âœ… **Workbook**: "Inline" vá»›i 2 queries QC vÃ  2 charts tiáº¿ng Viá»‡t
- âœ… **Files táº¡o**: insights_data_source.json, insights_workbook.json

## ğŸ¯ Best Practices

### 1. Naming Convention
```bash
# Äáº·t tÃªn file cÃ³ Ã½ nghÄ©a
insights_export_$(date +%Y%m%d)_$(hostname)_to_production.zip
```

### 2. Documentation
```bash
# Táº¡o file ghi chÃº
cat > transfer_notes.txt << EOF
Transfer Date: $(date)
Source: erp-sonnt.tiqn.local  
Target: erp.tiqn.local
Exported Items:
- 5 Dashboards
- 12 Charts  
- 8 Queries
- 3 Data Sources
Notes: Transferred for production deployment
EOF
```

### 3. Version Control
```bash
# Git track export files (náº¿u cáº§n)
git add insights_export_*.zip
git commit -m "Export insights data for production transfer"
```

### 4. Automation
```bash
# Cron job Ä‘á»ƒ export Ä‘á»‹nh ká»³
0 2 * * 0 cd /home/frappe/frappe-bench && python3 ~/insights-transfer/insights_manual_export_import.py export erp-sonnt.tiqn.local >/tmp/export.log 2>&1
```

## ğŸ“ Há»— Trá»£

### Log Files
```bash
# Check export logs
tail -f /tmp/insights_export_*/export.log

# Check import logs  
tail -f /tmp/insights_import.log
```

### Debug Mode
ThÃªm debug vÃ o script:
```python
def log(self, message, level="INFO"):
    timestamp = datetime.now().strftime('%H:%M:%S')
    log_msg = f"[{timestamp}] {level}: {message}"
    print(log_msg)
    
    # Debug file
    with open("/tmp/insights_debug.log", "a") as f:
        f.write(log_msg + "\n")
```

---

**ğŸ’¡ Pro Tips:**
- LuÃ´n test trÃªn dev environment trÆ°á»›c
- Sá»­ dá»¥ng rsync vá»›i `--progress` Ä‘á»ƒ track transfer lá»›n
- Compress ZIP vá»›i level 9 Ä‘á»ƒ tiáº¿t kiá»‡m bÄƒng thÃ´ng: `zip -9`
- Backup khÃ´ng chá»‰ data mÃ  cáº£ customizations